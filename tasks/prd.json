{
  "name": "修复 macOS 应用菜单规范",
  "description": "按照 macOS 人机界面指南，将菜单项正确放置到应用菜单中，包括关于、偏好设置、服务等",
  "branchName": "fixmenu-for-macos",
  "userStories": [
    {
      "id": "US-001",
      "title": "创建 macOS 应用菜单（App Menu）",
      "description": "作为 macOS 用户，我希望看到符合系统规范的应用菜单，第一个菜单显示应用名称 Medit，包含关于、偏好设置、服务等标准项目",
      "acceptanceCriteria": [
        "在 menu.rs 中创建 create_app_menu 函数，仅在 macOS 上编译",
        "应用菜单作为第一个菜单，显示应用名称 Medit",
        "包含 '关于 Medit' 菜单项，id 为 'app:about'",
        "包含分隔符",
        "包含 '偏好设置...' 菜单项，id 为 'app:preferences'，快捷键 Cmd+,",
        "包含分隔符",
        "包含 '隐藏 Medit'（系统自动提供，使用 PredefinedMenuItem::hide）",
        "包含 '隐藏其他'（系统自动提供，使用 PredefinedMenuItem::hide_others）",
        "包含 '显示全部'（系统自动提供，使用 PredefinedMenuItem::show_all）",
        "包含分隔符",
        "包含 '退出 Medit' 菜单项，id 为 'app:quit'，快捷键 Cmd+Q",
        "在 create_menu 主函数中，macOS 平台将应用菜单插入到第一个位置",
        "pnpm typecheck 通过",
        "cargo check 在 src-tauri 目录通过"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-002",
      "title": "从帮助菜单移除关于菜单项",
      "description": "作为 macOS 用户，关于菜单项应在应用菜单中而非帮助菜单",
      "acceptanceCriteria": [
        "修改 create_help_menu 函数，仅在非 macOS 平台包含 '关于 Medit'",
        "使用 #[cfg(not(target_os = \"macos\"))] 条件编译",
        "macOS 上帮助菜单只包含：文档、快捷键参考",
        "非 macOS 平台保持原有关于菜单项",
        "pnpm typecheck 通过",
        "cargo check 通过"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-003",
      "title": "处理应用菜单事件",
      "description": "作为用户，点击应用菜单项时应正确触发相应功能",
      "acceptanceCriteria": [
        "在 lib.rs 的 handle_menu_event 函数中添加 'app:about' 事件处理",
        "在 handle_menu_event 中添加 'app:preferences' 事件处理，发送 'menu:preferences' 事件到前端",
        "在 handle_menu_event 中添加 'app:quit' 事件处理，调用 app.exit(0)",
        "前端 MenuService 已有 'menu:preferences' 监听，确认可正常接收",
        "添加 'menu:app:about' 前端事件",
        "pnpm typecheck 通过",
        "cargo check 通过"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-004",
      "title": "更新前端 MenuService 处理新事件",
      "description": "作为开发者，需要在前端正确处理应用菜单事件",
      "acceptanceCriteria": [
        "在 menu-service.ts 的 MenuServiceConfig 接口添加 onAbout 回调",
        "添加 'menu:app:about' 事件监听",
        "确保 'menu:preferences' 事件（已存在）对应偏好设置功能",
        "pnpm typecheck 通过",
        "pnpm lint 通过"
      ],
      "priority": 4,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-003"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-005",
      "title": "验证菜单结构在 macOS 上正确显示",
      "description": "作为用户，在 macOS 上运行应用时菜单结构应符合系统规范",
      "acceptanceCriteria": [
        "在 macOS 上运行 pnpm tauri dev，菜单栏第一个菜单显示 Medit",
        "点击 Medit 菜单，显示：关于 Medit、分隔符、偏好设置...、分隔符、隐藏/显示相关、分隔符、退出 Medit",
        "Cmd+, 快捷键打开偏好设置",
        "Cmd+Q 快捷键退出应用",
        "文件菜单不包含退出项",
        "帮助菜单不包含关于项",
        "应用正常启动和退出，无崩溃"
      ],
      "priority": 5,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-002",
        "US-003",
        "US-004"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-006",
      "title": "确保非 macOS 平台菜单正常工作",
      "description": "作为 Windows/Linux 用户，菜单结构应保持原有功能",
      "acceptanceCriteria": [
        "在 Windows/Linux 上编译时应用菜单相关代码不包含在内",
        "文件菜单在非 macOS 平台仍然包含退出项",
        "帮助菜单在非 macOS 平台仍然包含关于项",
        "原有菜单功能全部正常",
        "cargo check --target x86_64-pc-windows-gnu 通过（或交叉编译检查）"
      ],
      "priority": 6,
      "passes": false,
      "notes": "",
      "dependsOn": [
        "US-002"
      ]
    }
  ],
  "metadata": {
    "updatedAt": "2026-02-12T19:55:59.310Z"
  }
}